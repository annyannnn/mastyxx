<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <link rel="stylesheet" href="assets/css/reviews-style.css" />
    <title>Отзывы - Салон красоты «Маsty»</title>
  </head>
  <body id="body">
    <header>
      <div class="header__container">
        <div class="header__items">
          <div class="header__img">
            <button
              onclick="window.location.href='https://vk.com/club234239337'"
              style="
                background: none;
                border: none;
                cursor: pointer;
                outline: none;
              "
            >
              <img src="assets/img/VK.svg" alt="" />
            </button>
          </div>

          <nav>
            <ul>
              <li><a href="index.html">Главная</a></li>
              <li><a href="masters.html">Мастера</a></li>
              <li><a href="price.html">Прайс</a></li>
            </ul>
          </nav>
          <img class="header__logo" src="assets/img/logo.svg" alt="" />
          <nav>
            <ul>
              <li><a href="stock.html">Акции</a></li>
              <li><a href="reviews.html">Отзывы</a></li>
              <li><a href="contacts.html">Контакты</a></li>
            </ul>
          </nav>
        </div>
      </div>
      <hr />
    </header>

    <div class="main-content">
      <div class="reviews-container">
        <h2 class="page-title">Отзывы о нашем салоне</h2>

        <div class="stats">
          <div class="stat-item">
            <div class="stat-value" id="totalReviews">0</div>
            <div class="stat-label">Всего отзывов</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="averageRating">0.0</div>
            <div class="stat-label">Средний рейтинг</div>
          </div>
          <div class="stat-item">
            <div class="stat-value">5★</div>
            <div class="stat-label">Лучшая оценка</div>
          </div>
        </div>

        <!-- Блок с отзывами -->
        <div class="reviews-section">
          <h2>Отзывы наших клиентов</h2>
          <div id="reviewsList">
            <!-- Отзывы будут добавляться с помощью JavaScript -->
          </div>
          <button id="showAllBtn" class="show-all-btn">
            Показать все отзывы
          </button>
        </div>

        <!-- Форма для отзыва -->
        <div class="review-form">
          <h2>Оставить отзыв</h2>
          <form id="reviewForm">
            <div class="form-group">
              <label for="name">Ваше имя</label>
              <input type="text" id="name" required />
            </div>

            <div class="form-group">
              <label for="service">Услуга</label>
              <select id="service" required>
                <option value="">Выберите услугу</option>
                <option value="Женская стрижка + укладка (короткие волосы)">
                  Женская стрижка + укладка (короткие волосы)
                </option>
                <option value="Женская стрижка + укладка (длинные волосы)">
                  Женская стрижка + укладка (длинные волосы)
                </option>
                <option value="Окрашивание">Окрашивание</option>
                <option value="Дневной макияж">Дневной макияж</option>
                <option value="Свадебный макияж">Свадебный макияж</option>
                <option value="Обучающий макияж">Обучающий макияж</option>
                <option value="Окрашивание бровей">Окрашивание бровей</option>
                <option value="Стоун массаж">Стоун массаж</option>
                <option value="Антицеллюлитный массаж">
                  Антицеллюлитный массаж
                </option>
                <option value="Массаж лица 'Тоффа'">Массаж лица "Тоффа"</option>
                <option value="Тайский массаж">Тайский массаж</option>
                <option value="Маникюр">Маникюр</option>
                <option value="Педикюр">Педикюр</option>
              </select>
            </div>

            <div class="form-group">
              <label for="rating">Оценка</label>
              <select id="rating" required>
                <option value="">Выберите оценку</option>
                <option value="5">Отлично (5 звезд)</option>
                <option value="4">Хорошо (4 звезды)</option>
                <option value="3">Удовлетворительно (3 звезды)</option>
                <option value="2">Плохо (2 звезды)</option>
                <option value="1">Очень плохо (1 звезда)</option>
              </select>
            </div>

            <div class="form-group">
              <label for="review">Текст отзыва</label>
              <textarea
                id="review"
                rows="5"
                required
                placeholder="Поделитесь вашими впечатлениями..."
              ></textarea>
            </div>

            <button type="submit">Отправить отзыв</button>
          </form>
        </div>
      </div>

      <!-- Боковая панель с призывом к VK -->
      <div class="sidebar">
        <div class="vk-promo">
          <a href="https://vk.com/club234239337" target="_blank" class="vk-icon"
            >VK</a
          >
          <h3>Больше отзывов в нашем сообществе VK</h3>
          <p>
            Присоединяйтесь к нашему сообществу ВКонтакте, чтобы увидеть больше
            отзывов от наших клиентов, узнать о новых акциях и получить
            эксклюзивные предложения!
          </p>
          <a
            href="https://vk.com/club234239337"
            target="_blank"
            class="vk-button"
            >Перейти в сообщество</a
          >
        </div>
      </div>
    </div>

    <footer>
      <div class="footer__items">
        <div class="footer__img">
          <img src="assets/img/footer__logo.svg" alt="" />
        </div>
        <div class="footer__contacts">
          <h2 style="color: #343434">Контакты</h2>
          <ul>
            <li style="color: #343434">+7 (909) 999-99-99</li>
            <li style="color: #343434">+7 (915) 123-45-67</li>
            <li style="color: #343434">Рязанский проспект, дом 39 лит. С</li>
          </ul>
        </div>
        <div class="working__time">
          <h2 style="color: #343434">Режим работы</h2>
          <ul>
            <li style="color: #343434">C 10:00 до 21:00 (Пн-Пт)</li>
            <li style="color: #343434">С 11:00 до 20:00 (Сб-Вс)</li>
          </ul>
        </div>
        <div class="social">
          <h2 style="color: #343434">Мы в социальных сетях</h2>
          <div>
            <button
              onclick="window.location.href='https://vk.com/club234239337'"
              style="
                background: none;
                border: none;
                padding: 0;
                cursor: pointer;
                outline: none;
              "
            >
              <img src="assets/img/VK.png" alt="" />
            </button>
            <button
              onclick="window.location.href='https://max.ru'"
              style="
                background: none;
                border: none;
                padding: 0;
                cursor: pointer;
                outline: none;
              "
            >
              <img src="assets/img/MAX.png" alt="" />
            </button>
          </div>
        </div>
      </div>
    </footer>
    <section>
      <div class="end">
        <h1>Copyright © 2017 - 2025</h1>
      </div>
    </section>

    <script>
      // Массив для хранения отзывов
      let reviews = [];
      let showAllReviews = false;
      const MAX_VISIBLE_REVIEWS = 3;

      // Функция для отображения отзывов
      function displayReviews() {
        const reviewsList = document.getElementById("reviewsList");
        reviewsList.innerHTML = "";

        if (reviews.length === 0) {
          reviewsList.innerHTML =
            '<div class="no-reviews">Пока нет отзывов. Будьте первым, кто оставит отзыв!</div>';
          document.getElementById("showAllBtn").classList.add("hidden");
          return;
        }

        // Сортируем отзывы по дате (новые первыми)
        reviews.sort((a, b) => new Date(b.date) - new Date(a.date));

        // Определяем, сколько отзывов показывать
        const reviewsToShow = showAllReviews
          ? reviews
          : reviews.slice(0, MAX_VISIBLE_REVIEWS);

        reviewsToShow.forEach((review, index) => {
          const reviewElement = document.createElement("div");
          reviewElement.className = "review";

          // Создаем звездочки для рейтинга
          let stars = "";
          for (let i = 0; i < 5; i++) {
            if (i < review.rating) {
              stars += "★";
            } else {
              stars += "☆";
            }
          }

          // Определяем, нужно ли сокращать текст
          const shouldShorten =
            !showAllReviews &&
            index < MAX_VISIBLE_REVIEWS &&
            review.text.length > 150;
          const displayText = shouldShorten
            ? review.text.substring(0, 150) + "..."
            : review.text;
          const textClass = shouldShorten ? "review-text short" : "review-text";

          reviewElement.innerHTML = `
                    <div class="review-header">
                        <div class="review-author">${review.name}</div>
                        <div class="review-date">${formatDate(
                          review.date
                        )}</div>
                    </div>
                    <div class="review-rating">${stars}</div>
                    <div class="${textClass}">${displayText}</div>
                    <div class="review-service">Услуга: ${review.service}</div>
                `;

          reviewsList.appendChild(reviewElement);
        });

        // Обновляем кнопку "Показать все/Скрыть"
        updateShowAllButton();

        // Добавляем кнопки удаления после отрисовки отзывов
        addDeleteButtons();
        updateStats();
      }

      // Функция для обновления кнопки "Показать все/Скрыть"
      function updateShowAllButton() {
        const showAllBtn = document.getElementById("showAllBtn");

        if (reviews.length <= MAX_VISIBLE_REVIEWS) {
          showAllBtn.classList.add("hidden");
        } else {
          showAllBtn.classList.remove("hidden");
          showAllBtn.textContent = showAllReviews
            ? "Скрыть отзывы"
            : `Показать все отзывы (${reviews.length})`;
        }
      }

      // Функция для добавления кнопок удаления
      function addDeleteButtons() {
        const reviewsElements = document.querySelectorAll(".review");

        reviewsElements.forEach((reviewElement, index) => {
          // Проверяем, есть ли уже кнопка удаления
          if (!reviewElement.querySelector(".delete-btn")) {
            const deleteBtn = document.createElement("button");
            deleteBtn.className = "delete-btn";
            deleteBtn.textContent = "×";
            deleteBtn.title = "Удалить отзыв";

            // Добавляем обработчик события
            deleteBtn.addEventListener("click", function () {
              if (confirm("Вы уверены, что хотите удалить этот отзыв?")) {
                // Удаляем из массива
                reviews.splice(index, 1);

                // Сохраняем в localStorage
                localStorage.setItem("reviews", JSON.stringify(reviews));

                // Обновляем отображение
                displayReviews();
              }
            });

            // Добавляем кнопку в заголовок отзыва
            const reviewHeader = reviewElement.querySelector(".review-header");
            if (reviewHeader) {
              reviewHeader.appendChild(deleteBtn);
            }
          }
        });
      }

      // Функция для обновления статистики
      function updateStats() {
        document.getElementById("totalReviews").textContent = reviews.length;

        if (reviews.length > 0) {
          const totalRating = reviews.reduce(
            (sum, review) => sum + review.rating,
            0
          );
          const averageRating = (totalRating / reviews.length).toFixed(1);
          document.getElementById("averageRating").textContent = averageRating;
        } else {
          document.getElementById("averageRating").textContent = "0.0";
        }
      }

      // Функция для форматирования даты
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("ru-RU", {
          day: "numeric",
          month: "long",
          year: "numeric",
        });
      }

      // Функция для обновления дат отзывов на октябрь-ноябрь 2025
      function updateReviewDates() {
        const octoberNovemberDates = [
          "2025-10-05",
          "2025-10-08",
          "2025-10-10",
          "2025-10-12",
          "2025-10-15",
          "2025-10-18",
          "2025-10-20",
          "2025-10-22",
          "2025-10-25",
          "2025-10-28",
          "2025-11-01",
          "2025-11-03",
          "2025-11-05",
          "2025-11-08",
          "2025-11-10",
          "2025-11-12",
        ];

        reviews.forEach((review, index) => {
          // Если дата относится к январю 2025, меняем на октябрь-ноябрь
          if (review.date && review.date.startsWith("2025-01")) {
            if (index < octoberNovemberDates.length) {
              review.date = octoberNovemberDates[index];
            } else {
              // Генерируем случайную дату в октябре-ноябре 2025
              const randomDay = Math.floor(Math.random() * 61) + 1;
              const date = new Date(2025, 9, randomDay);
              review.date = date.toISOString().split("T")[0];
            }
          }
        });

        // Сохраняем обновленные отзывы
        localStorage.setItem("reviews", JSON.stringify(reviews));
      }

      // Обработчик отправки формы
      document
        .getElementById("reviewForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const name = document.getElementById("name").value;
          const service = document.getElementById("service").value;
          const rating = parseInt(document.getElementById("rating").value);
          const text = document.getElementById("review").value;

          // Создаем новый отзыв
          const newReview = {
            name,
            service,
            rating,
            text,
            date: new Date().toISOString(),
          };

          // Добавляем отзыв в массив
          reviews.push(newReview);

          // Сохраняем в localStorage
          localStorage.setItem("reviews", JSON.stringify(reviews));

          // Очищаем форму
          document.getElementById("reviewForm").reset();

          // Обновляем отображение отзывов
          displayReviews();

          // Показываем сообщение об успехе
          alert("Спасибо за ваш отзыв!");
        });

      // Обработчик для кнопки "Показать все/Скрыть"
      document
        .getElementById("showAllBtn")
        .addEventListener("click", function () {
          showAllReviews = !showAllReviews;
          displayReviews();
        });

      // Инициализация при загрузке страницы
      document.addEventListener("DOMContentLoaded", function () {
        // Загружаем отзывы из localStorage, если они там есть
        const savedReviews = localStorage.getItem("reviews");
        if (savedReviews) {
          reviews = JSON.parse(savedReviews);
        } else {
          // Добавляем несколько примеров отзывов, если нет сохраненных
          reviews = [
            {
              name: "Анастасия",
              service: "Маникюр",
              rating: 5,
              text: "Очень довольна результатом! Мастер Юлия - профессионал своего дела. Цвет подобрали идеально, покрытие держится уже третью неделю без сколов.",
              date: "2025-10-10",
            },
            {
              name: "Мария",
              service: "Педикюр",
              rating: 4,
              text: "Хороший педикюр, аккуратно выполнен. Единственное - ждала немного дольше назначенного времени. Но результат того стоил!",
              date: "2025-10-08",
            },
            {
              name: "Елена",
              service: "Стоун массаж",
              rating: 5,
              text: "Невероятно расслабляющая процедура! После массажа горячими камнями чувствую себя заново рожденной. Обязательно повторю!",
              date: "2025-10-05",
            },
            {
              name: "Ольга",
              service: "Окрашивание",
              rating: 5,
              text: "Обслуживание на высшем уровне, встретили, предложили чай/кофе и десерты. Сходила на услугу к Наталие (парикмахер). Честно, не ожидала такого результата, она вывела 5 лет окрашивания в черный без явного вреда для волос. Они остались такими же мягкими. Мастер очень приятная, может поддержать беседу. Не жалею, что сходила, цена полностью соответствует качеству услуги",
              date: "2025-10-15",
            },
          ];
          localStorage.setItem("reviews", JSON.stringify(reviews));
        }

        // Обновляем даты отзывов на октябрь-ноябрь
        updateReviewDates();
        displayReviews();
      });
    </script>
    <script src="assets/js/modal.js"></script>
  </body>
</html>
